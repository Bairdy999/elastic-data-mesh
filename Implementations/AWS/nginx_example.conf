# Example nginx.conf file for use with Elasticsearch data mesh
# Change <domain_name> to one of your choice
# Assumes that a hosts entry for mesh-docker exists in /etc/hosts, pointing to the data mesh Docker VM

	server {
		server_name <domain_name>;
		location /cluster01 {
			client_max_body_size 20M;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_http_version 1.1;
			proxy_set_header Connection "Keep-Alive";
			proxy_set_header Proxy-Connection "Keep-Alive";
			proxy_pass http://mesh-docker:5601/cluster01;
		}

		location /cluster01/elastic/ {
			client_max_body_size 50M;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_http_version 1.1;
			proxy_set_header Connection "Keep-Alive";
			proxy_set_header Proxy-Connection "Keep-Alive";
			proxy_pass https://mesh-docker:9201/;
		}

		location /cluster02 {
			client_max_body_size 20M;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_http_version 1.1;
			proxy_set_header Connection "Keep-Alive";
			proxy_set_header Proxy-Connection "Keep-Alive";
			proxy_pass http://mesh-docker:5602/cluster02;
		}

		location /cluster02/elastic/ {
			client_max_body_size 50M;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_http_version 1.1;
			proxy_set_header Connection "Keep-Alive";
			proxy_set_header Proxy-Connection "Keep-Alive";
			proxy_pass https://mesh-docker:9202/;
		}

		location /cluster03 {
			client_max_body_size 20M;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_http_version 1.1;
			proxy_set_header Connection "Keep-Alive";
			proxy_set_header Proxy-Connection "Keep-Alive";
			proxy_pass http://mesh-docker:5603/cluster03;
		}

		location /cluster03/elastic/ {
			client_max_body_size 50M;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_http_version 1.1;
			proxy_set_header Connection "Keep-Alive";
			proxy_set_header Proxy-Connection "Keep-Alive";
			proxy_pass https://mesh-docker:9203/;
		}

		location /cluster04 {
			client_max_body_size 20M;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_http_version 1.1;
			proxy_set_header Connection "Keep-Alive";
			proxy_set_header Proxy-Connection "Keep-Alive";
			proxy_pass http://mesh-docker:5604/cluster04;
		}

		location /cluster04/elastic/ {
			client_max_body_size 50M;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_http_version 1.1;
			proxy_set_header Connection "Keep-Alive";
			proxy_set_header Proxy-Connection "Keep-Alive";
			proxy_pass https://mesh-docker:9204/;
		}

		location /cluster05 {
			client_max_body_size 20M;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_http_version 1.1;
			proxy_set_header Connection "Keep-Alive";
			proxy_set_header Proxy-Connection "Keep-Alive";
			proxy_pass http://mesh-docker:5605/cluster05;
		}

		location /cluster05/elastic/ {
			client_max_body_size 50M;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_http_version 1.1;
			proxy_set_header Connection "Keep-Alive";
			proxy_set_header Proxy-Connection "Keep-Alive";
			proxy_pass https://mesh-docker:9205/;
		}

		location /cluster06 {
			client_max_body_size 20M;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_http_version 1.1;
			proxy_set_header Connection "Keep-Alive";
			proxy_set_header Proxy-Connection "Keep-Alive";
			proxy_pass http://mesh-docker:5606/cluster06;
		}

		location /cluster06/elastic/ {
			client_max_body_size 50M;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_http_version 1.1;
			proxy_set_header Connection "Keep-Alive";
			proxy_set_header Proxy-Connection "Keep-Alive";
			proxy_pass https://mesh-docker:9206/;
		}

		location /cluster07 {
			client_max_body_size 20M;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_http_version 1.1;
			proxy_set_header Connection "Keep-Alive";
			proxy_set_header Proxy-Connection "Keep-Alive";
			proxy_pass http://mesh-docker:5607/cluster07;
		}

		location /cluster07/elastic/ {
			client_max_body_size 50M;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_http_version 1.1;
			proxy_set_header Connection "Keep-Alive";
			proxy_set_header Proxy-Connection "Keep-Alive";
			proxy_pass https://mesh-docker:9207/;
		}

		location /cluster08 {
			client_max_body_size 20M;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_http_version 1.1;
			proxy_set_header Connection "Keep-Alive";
			proxy_set_header Proxy-Connection "Keep-Alive";
			proxy_pass http://mesh-docker:5608/cluster08;
		}

		location /cluster08/elastic/ {
			client_max_body_size 50M;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_http_version 1.1;
			proxy_set_header Connection "Keep-Alive";
			proxy_set_header Proxy-Connection "Keep-Alive";
			proxy_pass https://mesh-docker:9208/;
		}

	
    listen 443 ssl; # managed by Certbot
    ssl_certificate /etc/letsencrypt/live/<domain_name>/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/<domain_name>/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot

}
